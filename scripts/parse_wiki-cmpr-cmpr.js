function parse_wikitext(ab){if(ckgedit_dwedit_reject){var ax=GetE("ebut_cancel");ax.click();return true}var ad=getComplexTables();function ap(b,a,g){var d=new Array();for(var e=a;e<b.length;e++){for(var f=0;f<b[e].length;f++){if(b[e][f].rowspan>0){var c=b[e][f].text;d.push({row:e,column:f,spans:b[e][f].rowspan,text:c});if(!g){break}}}}return d}function Z(a,f,d,c,b){var e=c[a][f].colspan?c[a][f].colspan:0;c[a][f].rowspan=0;for(S=0;S<d-1;S++){c[++a].splice(f,0,{type:"td",rowspan:0,colspan:e,prev_colspan:e,text:" ::: "})}}function ae(b){var e=ap(b,0,true);var g=e.length;if(!g){return false}var a=e[0].row;var f=e[0].column;Z(a,f,e[0].spans,b);g--;for(var c=0;c<g;c++){a++;var d=ap(b,a,false);if(d.length){Z(d[0].row,d[0].column,d[0].spans,b)}}return true}function aq(c){if(!ad){return}for(var e=0;e<c.length;e++){if(!ae(c)){break}}al+="\n";for(var e=0;e<c.length;e++){al+="\n";for(var f=0;f<c[e].length;f++){var d=c[e][f].type=="td"?"|":"^";al+=d;var a=c[e][f].align?c[e][f].align:false;if(a=="center"||a=="right"){al+="  "}al+=c[e][f].text;if(a=="center"||a=="left"){al+="  "}if(c[e][f].colspan){for(var b=0;b<c[e][f].colspan-1;b++){al+=d}}}al+="|"}}window.dwfckTextChanged=false;if(ab!="bakup"){draft_delete()}var ah="\nL_BR_K  \n";var Y={b:"**",i:"//",em:"//",u:"__",br:ah,strike:"<del>",del:"<del>",s:"<del>",p:"\n\n",a:"[[",img:"{{",strong:"**",h1:"\n====== ",h2:"\n===== ",h3:"\n==== ",h4:"\n=== ",h5:"\n== ",td:"|",th:"^",tr:" ",table:"\n\n",ol:"  - ",ul:"  * ",li:"",code:"''",pre:"\n<",hr:"\n\n----\n\n",sub:"<sub>",font:"",sup:"<sup>",div:"\n\n",span:"\n",dl:"\n",dd:"\n",dt:"\n"};var ao={del:"</del>",s:"</del>",strike:"</del>",p:" ",br:" ",a:"]]",img:"}}",h1:" ======\n",h2:" =====\n",h3:" ====\n",h4:" ===\n",h5:" ==\n",td:" ",th:" ",tr:"|\n",ol:" ",ul:" ",li:"\n",pre:"\n</",sub:"</sub>",sup:"</sup> ",div:"\n\n",p:"\n\n",font:"</font>",span:" "};Y.temp_u="CKGE_TMP_u";Y.temp_strong="CKGE_TMP_strong";Y.temp_em="CKGE_TMP_em";Y.temp_i="CKGE_TMP_i";Y.temp_b="CKGE_TMP_b";Y.temp_del="CKGE_TMP_del";Y.temp_strike="CKGE_TMP_strike";Y.temp_code="CKGE_TMP_code";Y.temp_sup="CKGE_TMP_sup";Y.temp_csup="CKGE_TMP_csup";Y.temp_sub="CKGE_TMP_sub";Y.temp_csub="CKGE_TMP_csub";Y.temp_del="CKGE_TMP_del";Y.temp_cdel="CKGE_TMP_cdel";Y.temp_strike="CKGE_TMP_del";Y.temp_cstrike="CKGE_TMP_cdel";Y.temp_s="CKGE_TMP_del";Y.temp_cs="CKGE_TMP_cdel";var ar={CKGE_TMP_b:"**",CKGE_TMP_strong:"**",CKGE_TMP_em:"//",CKGE_TMP_u:"__",CKGE_TMP_sup:"<sup>",CKGE_TMP_sub:"<sub>",CKGE_TMP_cdel:"</del>",CKGE_TMP_csub:"</sub>",CKGE_TMP_csup:"</sup>",CKGE_TMP_del:"<del>",CKGE_TMP_strike:"<del>",CKGE_TMP_code:"''"};Y.blank="";Y.fn_start="((";Y.fn_end="))";Y.row_span=":::";Y.p_insert="_PARA__TABLE_INS_";Y.format_space="_FORMAT_SPACE_";Y.pre_td="<";var aj={strong:true,b:true,i:true,em:true,u:true,del:true,strike:true,code:true,sup:true,sub:true,s:true};var al="";var i=false;var ak=false;var aB=false;var T=false;var av=false;var V=false;var R=false;var U=false;var aw=false;var W=false;var am=false;var P=false;var Q=false;var ac;var aA=new Array();var af=new Array();var ay=false;var az=Y.p_insert;var X="(br|co|coMULTI|es|kw|me|nu|re|st|sy)[0-9]";String.prototype.splice=function(a,b,c){return(this.slice(0,a)+c+this.slice(a+Math.abs(b)))};String.frasl=new RegExp("⁄|&frasl;|&#8260;|&#x2044;","g");X=new RegExp(X);HTMLParser(CKEDITOR.instances.wiki__text.getData(),{attribute:"",link_title:"",link_class:"",image_link_type:"",td_align:"",in_td:false,td_colspan:0,td_rowspan:0,rowspan_col:0,last_column:-1,row:0,col:0,td_no:0,tr_no:0,current_row:false,in_table:false,in_multi_plugin:false,is_rowspan:false,list_level:0,prev_list_level:-1,list_started:false,xcl_markup:false,in_link:false,link_formats:new Array(),last_tag:"",code_type:false,in_endnotes:false,is_smiley:false,geshi:false,downloadable_code:false,export_code:false,code_snippet:false,downloadable_file:"",external_mime:false,in_header:false,curid:false,format_in_list:false,prev_li:new Array(),link_only:false,in_font:false,using_fonts:false,interwiki:false,bottom_url:false,font_family:"inherit",font_size:"inherit",font_weight:"inherit",font_color:"inherit",font_bgcolor:"inherit",font_style:"inherit",is_mediafile:false,end_nested:false,mfile:false,backup:function(d,e){var a=al.lastIndexOf(d);var f=al.indexOf(e,a);if(a==-1||f==-1){return}if(d.length+f==f){var c=al.substring(0,a);var b=al.substring(f);al=c+b;return true}return false},is_iwiki:function(d,b){var c=d.match(/iw_(\w+\.?\w{0,12})/);var a=b.split(/\//);var e=a[a.length-1];e=e.replace(String.frasl,"/");if(!e.match(/oIWIKIo.*?cIWIKIc/)){e="oIWIKIo"+e+"cIWIKIc"}e=e.replace(/^.*?oIWIKIo/,"oIWIKIo");e=e.replace(/cIWIKIc.*/,"cIWIKIc");c[1]=c[1].replace(/_(\w{2})/,".$1");this.attr=c[1]+">"+e;am=true;this.interwiki=true},start:function(o,c,C){if(Y[o]){if(aj[o]&&this.in_link){this.link_formats.push(o);return}if(aj[o]&&(this.in_font||this.in_header)){al+=" ";var w="temp_"+o;al+=Y[w];al+=" ";return}else{if(o=="acronym"){return}}if(aj[o]&&this.in_endnotes){if(o=="sup"){return}}if(o=="ol"||o=="ul"){this.prev_list_level=this.list_level;this.list_level++;if(this.list_level==1){this.list_started=false}if(this.list_started){this.prev_li.push(Y.li)}Y.li=Y[o];return}else{if(!this.list_level){Y.li="";this.prev_li=new Array()}}this.is_mediafile=false;if(o=="img"){var r="?";var u;var q;var m=false;var E="";var J="";var D=false;this.is_smiley=false;this.in_link=false}if(o=="a"){var F=true;var L="";this.xcl_markup=false;this.in_link=true;this.link_pos=al.length;this.link_formats=new Array();this.footnote=false;var a=false;this.id="";this.external_mime=false;var b=false;this.export_code=false;this.code_snippet=false;this.downloadable_file="";var H=false;this.link_only=false;save_url="";this.interwiki=false;this.bottom_url=false;this.link_title=false;var y="";var I=""}if(o=="p"){this.in_link=false;if(this.in_table){o="p_insert";T=true}}if(o=="table"){this.td_no=0;this.tr_no=0;this.in_table=true;this.is_rowspan=false;this.row=-1;this.rows=new Array();ac=this.rows;this.table_start=al.length}else{if(o=="tr"){this.tr_no++;this.td_no=0;this.col=-1;this.row++;this.rows[this.row]=new Array();this.current_row=this.rows[this.row]}else{if(o=="td"||o=="th"){this.td_no++;this.col++;this.current_row[this.col]={type:o,rowspan:0,colspan:0,text:""};this.cell_start=al.length;this.current_cell=this.current_row[this.col];if(this.td_rowspan&&this.rowspan_col==this.td_no&&this.td_no!=this.last_column){this.is_rowspan=true;this.td_rowspan--}else{this.is_rowspan=false}}}}var s;this.attr=false;this.format_tag=false;if(aj[o]){this.format_tag=true}var K=false;for(var f=0;f<c.length;f++){if(o=="td"||o=="th"){if(c[f].name=="colspan"){this.current_row[this.col].colspan=c[f].value}if(c[f].name=="class"){if((s=c[f].value.match(/(left|center|right)/))){this.current_row[this.col].align=s[1]}}if(c[f].name=="rowspan"){this.current_row[this.col].rowspan=c[f].value}}if(c[f].escaped=="u"&&o=="em"){o="u";this.attr="u";break}if(o=="div"){if(c[f].name=="class"&&c[f].value=="footnotes"){o="blank";this.in_endnotes=true}break}if(o=="dl"&&c[f].name=="class"&&c[f].value=="file"){this.downloadable_code=true;aB=true;return}if(o=="span"&&c[f].name=="class"){if(c[f].value=="np_break"){return}}if(o=="span"&&c[f].name=="class"){if(c[f].value=="curid"){this.curid=true;return}if(c[f].value=="multi_p_open"){this.in_multi_plugin=true;R=true;return}if(c[f].value=="multi_p_close"){this.in_multi_plugin=false;return}if(c[f].value.match(X)){o="blank";this.geshi=true;break}}if(o=="span"&&!ckgedit_xcl_styles){if(c[f].name=="style"){if(!this.in_font){al+="__STYLE__"}this.in_font=true;this.using_fonts=true;s=c[f].value.match(/font-family:\s*([\w\-\s,]+);?/);if(s){this.font_family=s[1]}s=c[f].value.match(/font-size:\s*(.*)/);if(s){s[1]=s[1].replace(/;/,"");this.font_size=s[1]}s=c[f].value.match(/font-weight:\s*(\w+);?/);if(s){this.font_weight=s[1]}s=c[f].value.match(/.*?color:\s*(.*)/);var z=false;if(s){s[1]=s[1].replace(/;/,"");if(s[0].match(/background/)){this.font_bgcolor=s[1]}else{this.font_color=s[1]}}if(!z){s=c[f].value.match(/background:\s*(\w+)/);if(s&&s[0].match(/background/)){this.font_bgcolor=s[1]}}}}if(o=="td"||o=="th"){if(o=="td"){al=al.replace(/\^$/,"|")}this.in_td=true;if(c[f].name=="align"){this.td_align=c[f].escaped}else{if(c[f].name=="class"){s=c[f].value.match(/\s*(\w+)align/);if(s){this.td_align=s[1]}}else{if(c[f].name=="colspan"){av=true;this.td_colspan=c[f].escaped}else{if(c[f].name=="rowspan"){this.td_rowspan=c[f].escaped-1;this.rowspan_col=this.td_no}}}}T=true}if(o=="a"){if(c[f].name=="title"){this.link_title=c[f].escaped;if(I){y=c[f].escaped}else{this.link_title=this.link_title.replace(/\s+.*$/,"")}}else{if(c[f].name=="class"){if(c[f].value.match(/fn_top/)){this.footnote=true}else{if(c[f].value.match(/fn_bot/)){a=true}else{if(c[f].value.match(/mf_(png|gif|jpg|jpeg)/i)){this.link_only=true}}}this.link_class=c[f].escaped;b=this.link_class.match(/mediafile/)}else{if(c[f].name=="id"){this.id=c[f].value}else{if(c[f].name=="type"){L=c[f].value}else{if(c[f].name=="href"&&!this.code_type){var e=c[f].escaped.match(/https*:\/\//)?true:false;if(e){save_url=c[f].escaped}if(c[f].escaped.match(/\/lib\/exe\/detail.php/)){this.image_link_type="detail"}else{if(c[f].escaped.match(/exe\/fetch.php/)){this.image_link_type="direct"}}if(this.link_class&&this.link_class.match(/media/)&&!this.link_title){var A=c[f].escaped.match(/media=(.*)/);if(A){this.link_title=A[1]}}var t=c[f].escaped.match(/fetch\.php.*?media=.*?\.(png|gif|jpg|jpeg)$/i);if(t){t=t[1]}if(c[f].escaped.match(/^https*:/)){this.attr=c[f].escaped;F=false}if(c[f].escaped.match(/^ftp:/)){this.attr=c[f].escaped;F=false}else{if(c[f].escaped.match(/do=export_code/)){this.export_code=true}else{if(c[f].escaped.match(/^nntp:/)){this.attr=c[f].escaped;F=false}else{if(c[f].escaped.match(/^mailto:/)){this.attr=c[f].escaped.replace(/mailto:/,"");F=false}else{if(c[f].escaped.match(/m-files/)){this.attr=c[f].escaped;this.mfile=c[f].escaped;F=false}else{if(c[f].escaped.match(/^file:/)){var p=c[f].value.replace(/file:[\/]+/,"");p=p.replace(/[\/]/g,"\\");p="\\\\"+p;this.attr=p;F=false}else{if(e&&!t&&(s=c[f].escaped.match(/fetch\.php(.*)/))){if(s[1].match(/media=/)){g=s[1].split(/=/);this.attr=g[1]}else{s[1]=s[1].replace(/^\//,"");this.attr=s[1]}F=false;this.attr=decodeURIComponent?decodeURIComponent(this.attr):unescape(this.attr);if(!this.attr.match(/^:/)){this.attr=":"+this.attr}this.external_mime=true}else{F=false;s=c[f].escaped.match(/doku.php\?id=(.*)/);if(!s){s=c[f].escaped.match(/doku.php\/(.*)/)}if(s){if(!s[1].match(/\?/)&&s[1].match(/&amp;/)){H=true;s[1]=s[1].replace(/&amp;/,"?")}}if(s&&s[1]){if(!s[1].match(/^:/)){this.attr=":"+s[1]}else{this.attr=s[1]}if(this.attr.match(/\.\w+$/)){if(L&&L=="other_mime"){this.external_mime=true}else{for(var k=f+1;k<c.length;k++){if(c[k].value.match(/other_mime/)){this.external_mime=true}break}}}}else{s=c[f].value.match(/\\\\/);if(s){this.attr=c[f].escaped;F=false}}}}}}}}}if(this.link_class=="media"){if(c[f].value.match(/http:/)){F=false}}if(!this.attr&&this.link_title){if(s=this.link_class.match(/media(.*)/)){this.link_title=decodeURIComponent(safe_convert(this.link_title));this.attr=this.link_title;var h=s[1].split(/_/);if(h&&h[1]){t=h[1]}else{if(h){t=h[0]}else{t="mf"}}if(!this.attr.match(/^:/)&&!this.attr.match(/^https?\:/)){this.attr=":"+this.attr.replace(/^\s+/,"")}this.external_mime=true;F=false}}if(this.attr.match&&this.attr.match(/%[a-fA-F0-9]{2}/)&&(s=this.attr.match(/userfiles\/file\/(.*)/))){s[1]=s[1].replace(/\//g,":");if(!s[1].match(/^:/)){s[1]=":"+s[1]}this.attr=decodeURIComponent?decodeURIComponent(s[1]):unescape(s[1]);this.attr=decodeURIComponent?decodeURIComponent(this.attr):unescape(this.attr);this.external_mime=true}if(this.link_title&&this.link_title.match(/Snippet/)){this.code_snippet=true}if(c[f].value.match(/^#/)&&this.link_class.match(/wikilink/)){this.attr=c[f].value;this.link_title=false}if(this.link_class.match(/wikilink/)&&this.link_title){this.external_mime=false;if(!this.attr){this.attr=this.link_title}if(!this.attr.match(/^:/)){this.attr=":"+this.attr}if(this.attr.match(/\?.*?=/)){var g=this.attr.split(/\?/);g[0]=g[0].replace(/\//g,":");this.attr=g[0]+"?"+g[1]}else{this.attr=this.attr.replace(/\//g,":")}if(!H&&c[f].name=="href"){if(!this.attr.match(/\?.*?=/)&&!c[f].value.match(/doku.php/)){var d=c[f].value.match(/(\?.*)$/);if(d&&d[1]){this.attr+=d[1]}}}}else{if(this.link_class.match(/mediafile/)&&this.link_title&&!this.attr){this.attr=this.link_title;this.external_mime=true;if(!this.attr.match(/^:/)){this.attr=":"+this.attr}}else{if(this.link_class.match(/interwiki/)){I=this.link_class}}}if(this.link_class=="urlextern"&&!this.mfile&&save_url){this.attr=save_url;this.external_mime=false}if(this.in_endnotes){if(this.link_title){this.bottom_url=this.link_title}else{if(this.attr){this.bottom_url=this.attr}}}this.link_title="";this.link_class=""}}}}}}if(I&&y){this.is_iwiki(I,y);I="";y=""}if(o=="sup"){if(c[f].name=="class"){s=c[f].value.split(/\s+/);if(s[0]=="dwfcknote"){this.attr=s[0];o="blank";if(oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[s[1]]){K="(("+oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[s[1]]+"))"}break}}}if(o=="pre"){if(c[f].name=="class"){var g=c[f].escaped.split(/\s+/);if(g.length>1){this.attr=c[f].value;this.code_type=g[0]}else{this.attr=c[f].escaped;this.code_type=this.attr}if(this.downloadable_code){this.attr=this.attr.replace(/\s*code\s*/,"");this.code_type="file"}ak=true;if(this.in_table){o="pre_td"}break}}else{if(o=="img"){if(c[f].name=="alt"){J=c[f].value}if(c[f].name=="type"){this.image_link_type=c[f].value}if(c[f].name=="src"){var B="";if(s=c[f].escaped.match(/fetch\.php.*?(media=.*)/)){var g=s[1].split("=");B=g[1];if(s=c[f].escaped.match(/(media.*)/)){var g=s[1].split("=");var l=g[1];B=decodeURIComponent?decodeURIComponent(l):unescape(l)}if(!B.match(/https?:/)&&!B.match(/^:/)){B=":"+B}}else{if(c[f].escaped.match(/https?:\/\//)){B=c[f].escaped;B=B.replace(/\?.*?$/,"")}else{if(s=c[f].escaped.match(/\/_media\/(.*)/)){var g=s[1].split(/\?/);B=g[0];B=B.replace(/\//g,":");if(!B.match(/^:/)){B=":"+B}}else{if(s=c[f].escaped.match(/\/lib\/exe\/fetch.php\/(.*)/)){var g=s[1].split(/\?/);B=g[0];if(!B.match(/^:/)){B=":"+B}}else{s=c[f].escaped.match(/^.*?\/userfiles\/image\/(.*)/);if(!s){var n=doku_base+"data/media/";n=n.replace(/([\/\\])/g,"\\$1");n="^.*?"+n+"(.*)";n=new RegExp(n);s=c[f].escaped.match(n)}if(s&&s[1]){B=s[1].replace(/\//g,":");B=":"+B}else{B=decodeURIComponent?decodeURIComponent(c[f].escaped):unescape(c[f].escaped);if(B.search(/data:image.*?;base64/)>-1){D=true}}if(B&&B.match(/lib\/images\/smileys/)){this.is_smiley=true}}}}}this.attr=B;if(this.attr&&this.attr.match&&this.attr.match(/%[a-fA-F0-9]{2}/)){this.attr=decodeURIComponent(safe_convert(this.attr));this.attr=decodeURIComponent(safe_convert(this.attr))}}else{if(c[f].name=="width"&&!m){u=c[f].value}else{if(c[f].name=="height"&&!m){q=c[f].value}else{if(c[f].name=="style"){var j=c[f].escaped.match(/width:\s*(\d+)/);if(j){u=j[1];var j=c[f].escaped.match(/height:\s*(\d+)/);if(j){q=j[1]}}}else{if(c[f].name=="align"||c[f].name=="class"){if(c[f].escaped.match(/(center|middle)/)){E="center"}else{if(c[f].escaped.match(/right/)){E="right"}else{if(c[f].escaped.match(/left/)){E="left"}else{E=""}}}}}}}}}}}if(this.is_smiley){if(J){al+=J+" ";J=""}this.is_smiley=false;return}if(this.link_only){o="img"}if(o=="br"){if(this.in_multi_plugin){al+="\n";return}if(!this.code_type){i=true}else{if(this.code_type){al+="\n";return}}if(this.in_table){al+=az;return}if(this.list_started){al+="_LIST_EOFL_"}else{al+="\\\\  ";return}}else{if(o.match(/^h(\d+|r)/)){var G=al.length;if(o.match(/h(\d+)/)){this.in_header=true}if(G){if(al.charCodeAt(G-1)==32){al=al.replace(/\x20+$/,"")}}}else{if(this.last_col_pipes){if(aj[o]){al+=Y[o]}o="blank"}else{if(K){al+=K;return}}}}if(o=="b"||o=="i"&&this.list_level){if(al.match(/(\/\/|\*)(\x20)+/)){al=al.replace(/(\/\/|\*)(\x20+)\-/,"$1\n$2-")}}if(o=="li"&&this.list_level){if(this.list_level==1&!this.list_started){al+="\n";this.list_started=true}al=al.replace(/[\x20]+$/,"");for(var v=0;v<this.list_level;v++){if(al.match(/_FORMAT_SPACE_\s*$/)){al=al.replace(/_FORMAT_SPACE_\s*$/,"\n")}if(this.list_level>1){al+="  "}}if(this.prev_list_level>0&&Y.li==Y.ol){this.prev_list_level=-1}}if(o=="a"&&F){this.xcl_markup=true;return}else{if(o=="a"&&(this.export_code||this.code_snippet)){return}else{if(o=="a"&&this.footnote){o="fn_start"}else{if(o=="a"&&a){aA.push(this.id)}else{if(o=="a"&&this.external_mime){if(this.in_endnotes){this.link_class="media";return}if(b&&b=="mediafile"){al+=Y.img;al+=this.attr+"|";this.is_mediafile=true}return}else{if(this.in_font){return}}}}}}if(this.in_endnotes&&o=="a"){return}if(this.code_type&&o=="span"){o="blank"}if(this.mfile&&!this.attr){this.attr=this.mfile}al+=Y[o];if(o=="td"||o=="th"||(this.last_col_pipes&&this.td_align=="center")){if(this.is_rowspan){al+=Y.row_span+" | ";this.is_rowspan=false}if(this.td_align=="center"||this.td_align=="right"){al+="  "}}else{if(o=="a"&&this.attr){this.attr=this.attr.replace(/%7c/,"%257c");al+=this.attr+"|"}else{if(o=="img"){var x=this.image_link_type;this.image_link_type="";if(this.link_only){x="link_only"}if(!x||D){x="nolink"}else{if(x=="detail"){x=""}}if(x=="link_only"){r="?linkonly"}else{if(x){r+=x+"&"}}if(u&&q){r+=u+"x"+q}else{if(u){r+=u}else{if(!x){r=""}}}if(E&&E!="left"){al+="  "}this.attr+=r;if(E=="center"||E=="left"){this.attr+="  "}al+=this.attr+"}}";this.attr="src"}else{if(o=="pre"||o=="pre_td"){if(this.downloadable_file){this.attr+=" "+this.downloadable_file}if(!this.attr){this.attr="code"}al+=this.attr+">";this.downloadable_file="";this.downloadable_code=false}}}}}},end:function(n){if(aj[n]&&(this.in_font||this.in_header)){al+=" ";if(n=="sup"||n=="sub"||n=="del"||n=="strike"||n=="s"){var o="temp_c"+n}else{var o="temp_"+n}al+=Y[o];al+=" ";return}if(this.in_link&&aj[r]&&this.link_formats.length){return}else{if(n=="a"&&!this.link_formats.length){this.in_link=false}}if(this.link_only){this.link_only=false;return}if(!Y[n]){return}if(n=="sup"&&this.attr=="dwfcknote"){return}if(this.is_smiley){this.is_smiley=false;if(n!="li"){return}}if(n=="span"&&this.in_font&&!ckgedit_xcl_styles){n="font";var b="<font "+this.font_size+"/"+this.font_family+";;"+this.font_color+";;"+this.font_bgcolor+">";var q=b.match(/(inherit)/g);if(q&&q.length<3){Q=true}var f=al.lastIndexOf("__STYLE__");al=al.splice(f,9,b);al=al.replace(/_FORMAT_SPACE_<font/m,"<font");this.font_size="inherit";this.font_family="inherit";this.font_color="inherit";this.font_bgcolor="inherit";this.in_font=false;P=true;al=al.replace(/__STYLE__/g,"")}if(n=="span"&&this.curid){this.curid=false;return}if(n=="dl"&&this.downloadable_code){this.downloadable_code=false;return}if(ad&&(n=="td"||n=="th")){this.current_cell.text=al.substring(this.cell_start);this.current_cell.text=this.current_cell.text.replace(/:::/gm,"");this.current_cell.text=this.current_cell.text.replace(/^[\s\|\^]+/,"")}if(n=="a"&&(this.export_code||this.code_snippet)){this.export_code=false;this.code_snippet=false;return}if(this.code_type&&n=="span"){n="blank"}var r=n;if(this.footnote){n="fn_end";this.footnote=false}else{if(n=="a"&&this.xcl_markup){this.xcl_markup=false;return}else{if(n=="table"){this.in_table=false;if(ad){al=al.substring(0,this.table_start);aq(this.rows)}}}}if(n=="p"&&this.in_table){n="p_insert";T=true}if(this.geshi){this.geshi=false;return}if(n=="code"&&!this.list_started){if(al.match(/''\s*$/m)){al=al.replace(/''\s*$/,"\n");return}}else{if(n=="a"&&this.attr=="src"){if(this.backup("[[","{")){return}}}if(this.end_nested){this.end_nested=false;return}if(n=="ol"||n=="ul"){this.list_level--;if(!this.list_level){this.format_in_list=false}if(this.prev_li.length){Y.li=this.prev_li.pop();this.end_nested=true;return}n="\n\n"}else{if(n=="a"&&this.external_mime){this.external_mime=false;if(this.is_mediafile){n="}} "}else{return}}else{if(n=="pre"){n=ao[n];if(this.code_type){n+=this.code_type+">"}else{var l=al.lastIndexOf("code");var j=al.lastIndexOf("file");if(j>l){this.code_type="file"}else{this.code_type="code"}n+=this.code_type+">"}this.code_type=false}else{if(ao[n]){n=ao[n]}else{if(this.attr=="u"&&n=="em"){n="u"}else{if(n=="acronym"){}else{n=Y[n]}}}}}}if(r=="tr"){if(this.last_col_pipes){n="\n";this.last_col_pipes=""}if(this.td_rowspan&&this.rowspan_col==this.td_no+1){this.is_rowspan=false;this.last_column=this.td_no;this.td_rowspan--;n="|"+Y.row_span+"|\n"}}else{if(r=="td"||r=="th"){this.last_col_pipes="";this.in_td=false}else{if(r.match(/h\d+/)){this.in_header=false}}}if(Y.li){if(al.match(/\n$/)&&!this.list_level){n=""}}if(this.in_endnotes&&n=="a"){return}if(this.in_endnotes&&r=="sup"){return}al+=n;if(aj[r]){if(this.list_level){this.format_in_list=true;aw=true}al+=Y.format_space;V=Y.format_space}this.last_tag=r;if(this.td_colspan&&!ad){if(this.td_align=="center"){al+=" "}var k="|";if(r=="th"){k="^"}var g=k;for(var e=1;e<this.td_colspan;e++){g+=k}this.last_col_pipes=g;al+=g;this.td_colspan=false}else{if(this.td_align=="center"){al+=" ";this.td_align=""}}if(r=="a"&&this.link_formats.length){var p=al.substring(this.link_pos);var d=al.substring(0,this.link_pos);var m="";var a="";for(var e=0;e<this.link_formats.length;e++){var h=Y[this.link_formats[e]];var c=ao[this.link_formats[e]]?ao[this.link_formats[e]]:h;m+=Y[this.link_formats[e]];a=c+a}d+=m;p+=a;al=d+p;this.link_formats=new Array();this.in_link=false}else{if(r=="a"){this.link_formats=new Array();this.in_link=false}}},chars:function(b){b=b.replace(/\t/g,"    ");if(b.match(/~~START_HTML_BLOCK~~/)){b=b.replace(/~~START_HTML_BLOCK~~\n*/,"~~START_HTML_BLOCK~~\n<code>\n")}if(b.match(/~~CLOSE_HTML_BLOCK~~/)){b=b.replace(/~~CLOSE_HTML_BLOCK~~\n*/gm,"\n</code>\n\n~~CLOSE_HTML_BLOCK~~\n\n")}if(this.interwiki){b=b.replace(String.frasl,"/")}if(this.interwiki&&al.match(/>\w+\s*\|$/)){this.interwiki=false;if(this.attr){al+=b}else{al=al.replace(/>\w+\s*\|$/,">"+b)}return}if(this.in_multi_plugin){b=b.replace("&lt; ","&lt;")}b=b.replace(/&#39;/g,"'");b=b.replace(/^(&gt;)+/,function(f,g){return(f.replace(/(&gt;)/g,"__QUOTE__"))});al=al.replace(/([\/\*_])_FORMAT_SPACE_([\/\*_]{2})_FORMAT_SPACE_$/,"$1$2");if(b.match(/^&\w+;/)){al=al.replace(/_FORMAT_SPACE_\s*$/,"")}if(this.link_only){if(b){replacement="|"+b+"}} ";al=al.replace(/\}\}\s*$/,replacement)}return}if(!this.code_type){if(!this.last_col_pipes){b=b.replace(/\x20{6,}/,"   ");b=b.replace(/^(&nbsp;)+\s*$/,"_FCKG_BLANK_TD_");b=b.replace(/(&nbsp;)+/," ")}if(this.format_tag){if(!this.list_started||this.in_table){b=b.replace(/^\s+/,"@@_SP_@@")}}else{if(this.last_tag=="a"){b=b.replace(/^\s{2,}/," ")}else{if(!this.using_fonts){b=b.replace(/^\s+/,"")}}}if(b.match(/nowiki&gt;/)){U=true}if(this.format_in_list||(P&&this.list_started)){b=b.replace(/^[\n\s]+$/g,"");if(b.match(/\n{2,}\s{1,}/)){b=b.replace(/\n{2,}/,"\n")}}if(this.in_td&&!b){b="_FCKG_BLANK_TD_";this.in_td=false}}else{b=b.replace(/&lt;\s/g,"<");b=b.replace(/\s&gt;/g,">");var a=b.match(/^\s*geshi:\s+(.*)$/m);if(a){al=al.replace(/<(code|file)>\s*$/,"<$1 "+a[1]+">");b=b.replace(a[0],"")}}if(this.attr&&this.attr=="dwfcknote"){if(b.match(/fckgL\d+/)){return}if(b.match(/^[\-,:;!_]/)){al+=b}else{al+=" "+b}return}if(this.downloadable_code&&(this.export_code||this.code_snippet)){this.downloadable_file=b;return}if(this.last_tag=="a"&&b.match(/^[\.,;\:\!]/)){al=al.replace(/\s$/,"")}if(this.in_header){b=b.replace(/---/g,"&mdash;");b=b.replace(/--/g,"&ndash;")}if(this.list_started){al=al.replace(/_LIST_EOFL_\s*L_BR_K\s*$/,"_LIST_EOFL_")}if(!this.code_type){if(!al.match(/\[\[\\\\.*?\|$/)&&!b.match(/\w:(\\(\w?))+/)){if(!b.match(/\\\\[\w\.\-\_]+\\[\w\.\-\_]+/)){b=b.replace(/([\\])/g,"%%$1%%")}b=b.replace(/([\*])/g,"_CKG_ASTERISK_")}}if(this.in_endnotes&&aA.length){if(b.match(/\w/)&&!b.match(/^\s*\d\)\s*$/)){b=b.replace(/\)\s*$/,"_FN_PAREN_C_");var e=aA.length-1;if(this.bottom_url){if(this.link_class&&this.link_class=="media"){b="{{"+this.bottom_url+"|"+b+"}}"}else{b="[["+this.bottom_url+"|"+b+"]]"}}if(af[aA[e]]){b=b.replace("(","L_PARgr");b=b.replace(")","R_PARgr");af[aA[e]]+=" "+b}else{b=b.replace("(","L_PARgr");b=b.replace(")","R_PARgr");af[aA[e]]=b}}this.bottom_url=false;return}if(b&&b.length){al+=b}al=al.replace(/(&\w+;)\s*([\*\/_]{2})_FORMAT_SPACE_(\w+)/,"$1$2$3");if(this.list_level&&this.list_level>1){al=al.replace(/(\[\[.*?\]\])([ ]+[\*\-].*)$/," $1\n$2")}try{var c=new RegExp("([*/_]{2,})_FORMAT_SPACE_([*/_]{2,})("+RegExp.escape(b)+")$");if(al.match(c)){al=al.replace(c,"$1$2$3")}}catch(d){}if(!ay){if(b.match(/&lt;/)){ay=true}}},comment:function(a){},dbg:function(b,a){if(b.replace){b=b.replace(/^\s+/g,"");b=b.replace(/^\n$/g,"");b=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(!b){return}}if(a){a="<b>"+a+"</b>\n"}HTMLParser_DEBUG+=a+b+"\n__________\n"}});al=al.replace(/(\[\[\\\\)(.*?)\]\]/gm,function(a,b,c){c=c.replace(/\\/g,"_SMB_");return b+c+"]]"});al=al.replace(/%%\\%%/g,"_ESC_BKSLASH_");al=al.replace(/%*\\%*([^\w]{1})%*\\%*/g,"$1");al=al.replace(/_SMB_/g,"\\");al=al.replace(/(\s*={2,})\s*CKGE_TMP_(\w+)(.*?)\s*CKGE_TMP_c?\2/gm,function(c,a){c=c.replace(/CKGE_TMP_\w+/gm,"");var b=jQuery("#formatdel").val();if(!b){jQuery("#dw__editform").append('<input type="hidden" id="formatdel" name="formatdel" value="del" />')}return c});al=al.replace(/\s?(CKGE_TMP_\w+)\s?/gm,function(b,a){if(ar[a]){return ar[a]}return b});if(ab=="test"){if(!HTMLParser_test_result(al)){return}}al=al.replace(/\{ \{ rss&gt;Feed:/mg,"{{rss&gt;http://");al=al.replace(/~ ~ (NOCACHE|NOTOC)~ ~/mg,"~~$1~~");if(am){var ai=function(a,b){tag_1=a.replace(/oIWIKIo(.*)cIWIKIc/,"$1");if(tag_1==b){return true}b=b.replace(/\s/,"%20");return(b==tag_1)};al=al.replace(/\[\[(\w+\.?\w{0,12})>(.*?)\|(.*?)\]\]/gm,function(d,b,c,a){if(c=="oIWIKIocIWIKIc"){c=a}if((c=="oIWIKIo"+a.replace(/\s/,"%20")+"cIWIKIc")||(c==a)||ai(c,a)){a=""}else{a="|"+a}return("[["+b+">"+c+a+"]]")})}al=al.replace(/>.*?oIWIKIo(.*?)cIWIKIc/mg,">$1");if(V){if(av){al=al.replace(/\s*([\|\^]+)((\W\W_FORMAT_SPACE_)+)/gm,function(a,c,b){b=b.replace(/_FORMAT_SPACE_/g,"");return(b+c)})}al=al.replace(/&quot;/g,'"');var au=new RegExp(V+"([\\-]{2,})","g");al=al.replace(au," $1");var au=new RegExp("(&amp;|\\W|\\w|\\d)(\\*\\*|\\/\\/|\\'\\'|__|</del>)+"+V+"(\\w|\\d)","g");al=al.replace(au,"$1$2$3");var au=new RegExp(V+"@@_SP_@@","g");al=al.replace(au," ");al=al.replace(/([\*\/_]{2})@@_SP_@@(&\w+;)/g,"$1 $2");al=al.replace(/\n@@_SP_@@\n/g,"");al=al.replace(/@@_SP_@@\n/g,"");al=al.replace(/@@_SP_@@/g," ");var au=new RegExp(V+"([^\\)\\]\\}\\{\\-\\.,;:\\!?\"\x94\x92\u201D\u2019'])","g");al=al.replace(au," $1");au=new RegExp(V,"g");al=al.replace(au,"");if(aw){al=al.replace(/(\s+[\-\*_]\s*)([\*\/_\']{2})(.*?)(\2)([^\n]*)\n+/gm,function(e,c,b,a,f,d){return(c+b+a+f+d+"\n")})}}var an="\\\\";if(i){al=al.replace(/(L_BR_K)+/g,an);al=al.replace(/L_BR_K/gm,an);al=al.replace(/(\\\\)\s+/gm,"$1 \n")}if(ak){al=al.replace(/\s+<\/(code|file)>/g,"\n</$1>");if(aB){al=al.replace(/\s+;/mg,";");al=al.replace(/&lt;\s+/mg,"<");al=al.replace(/\s+&gt;/mg,">")}}if(T){al+="\n"+an+"\n";var au=new RegExp(az,"g");al=al.replace(au," "+an+" ");al=al.replace(/(\||\^)[ ]+(\||\^)\s$/g,"$1\n");al=al.replace(/(\||\^)[ ]+(\||\^)/g,"$1")}al=al.replace(/_FCKG_BLANK_TD_/g," ");if(ay){al=al.replace(/\/\/&lt;\/\/\s*/g,"&lt;")}if(P){var au=/\>\s+(\*\*|__|\/\/|'')\s+_\s+\1\s+<\/font>/gm;al=al.replace(au,function(a){a=a.replace(/\s+/g,"");return a});if(Q){al=al.replace(/<\/font>\s{1}/gm,"</font>")}al=al.replace(/(<font[^\>]+>)([^<]+(\]\])?)[^\>]+\/font>\s*(\]\])/gm,function(c,d,a){a=a.replace(/\n/gm,"");a=a.replace(/\s/gm,"");a=a.replace(/[\[\]]/g,"");a="[["+a+"]]";var b=prompt(LANG.plugins.ckgedit.font_err_1+"\n"+a+"\n"+LANG.plugins.ckgedit.font_err_2);if(b==null){if(ckgedit_to_dwedit){ckgedit_to_dwedit=false;return a}else{throw new Error(LANG.plugins.ckgedit.font_err_throw)}}if(b){return b}return a});al=al.replace(/\[\[(.*?)\|(<font[^\>]+>)(.*?)(<\/font>)\s*(\]\])\s*/gm,function(c,e,b,a){c="[["+e+"|"+a+"]]";var d=jQuery("#fontdel").val();if(!d){jQuery("#dw__editform").append('<input type="hidden" id="fontdel" name="fontdel" value="del" />')}return c})}if(aA.length){al=al.replace(/<sup>\(\(\){2,}\s*<\/sup>/g,"");al=al.replace(/\(\(+(\d+)\)\)+/,"(($1))");for(var S in af){var aC=S.match(/_(\d+)/);var at=new RegExp("(<sup>)*[(]+"+aC[1]+"[)]+(</sup>)*");af[S]=af[S].replace(/(\d+)_FN_PAREN_C_/,"");al=al.replace(at,"(("+af[S].replace(/_FN_PAREN_C_/g,") ")+"))")}al=al.replace(/<sup><\/sup>/g,"");al=al.replace(/((<sup>\(\(\d+\)\)\)?<\/sup>))/mg,function(a){if(!a.match(/p>\(\(\d+/)){return""}return a})}al=al.replace(/(={3,}.*?)(\{\{.*?\}\})(.*?={3,})/g,"$1$3\n\n$2");al=al.replace(/(<sup>)*\s*\[\[\s*\]\]\s*(<\/sup>)*\n*/g,"");al=al.replace(/<sup>\s*\(\(\d+\)\)\s*<\/sup>/mg,"");if(R){al=al.replace(/<\s+/g,"<");al=al.replace(/&lt;\s+/g,"<")}if(U){var ag="%";var au=new RegExp("(["+ag+"])","g");al=al.replace(/(&lt;nowiki&gt;)(.*?)(&lt;\/nowiki&gt;)/mg,function(d,b,a,c){a=a.replace(/%%(.)%%/mg,"NOWIKI_$1_");return b+a.replace(au,"NOWIKI_$1_")+c})}al=al.replace(/__SWF__(\s*)\[*/g,"{{$1");al=al.replace(/\|.*?\]*(\s*)__FWS__/g,"$1}}");al=al.replace(/(\s*)__FWS__/g,"$1}}");al=al.replace(/\n{3,}/g,"\n\n");al=al.replace(/_LIST_EOFL_/gm," "+an+" ");if(ad){if(al.indexOf("~~COMPLEX_TABLES~~")==-1){al+="~~COMPLEX_TABLES~~\n"}}else{al=al.replace(/~~COMPLEX_TABLES~~/gm,"")}al=al.replace(/_CKG_ASTERISK_/gm,"*");al=al.replace(/_ESC_BKSLASH_/g,"\\");if(ab=="test"){if(HTMLParser_test_result(al)){alert(al)}return}var aa=GetE("dw__editform");aa.elements.fck_wikitext.value=al;if(ab=="bakup"){return}if(ab){var ax=GetE(ab);ax.click();return true}}jQuery(document).ready(function(){jQuery("#ebut_test").mousedown(function(){parse_wikitext("test")});jQuery("#ebtn__delete").click(function(){return confirm(JSINFO.confirm_delete)});jQuery("#ebtn__delete").mouseup(function(){draft_delete()});jQuery("#ebtn__dwedit").click(function(){ckgedit_to_dwedit=true;if(!window.dwfckTextChanged&&ckgedit_hasCaptcha){jQuery("#dw__editform").append('<input type="hidden" id="ckged_captcha_err" name="ckged_captcha_err" value="hide" />')}setDWEditCookie(2,this);parse_wikitext("edbtn__save");this.form.submit()});jQuery("#ckgedit_draft_btn").click(function(){ckgedit_get_draft()});jQuery("#backup_button").click(function(){renewLock(true)});jQuery("#revert_to_prev_btn").click(function(){revert_to_prev()});jQuery("#no_styling_btn").click(function(){this.form.styling.value="no_styles";this.form.prefix.value="";this.form.suffix.value="";this.form.rev.value=""});jQuery("#ebut_cancel").mouseup(function(){draft_delete()});jQuery("#save_button").mousedown(function(){if(!window.dwfckTextChanged&&!JSINFO.cg_rev){ckgedit_dwedit_reject=true;parse_wikitext("ebut_cancel")}else{parse_wikitext("edbtn__save")}})});